# ğŸ“˜ Auth æ¨¡å— API æ–‡æ¡£ï¼ˆæœ€ç»ˆç‰ˆï¼‰

## åŸºç¡€è¯´æ˜

### **æ¥å£ URL å‰ç¼€**

```
/api/auth
```

### **ç»Ÿä¸€å“åº”æ ¼å¼ï¼ˆæ‰€æœ‰æ¥å£éµå¾ªï¼‰**

```json
{
  "code": 0,            // 0 è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–ä¸ºé”™è¯¯ç 
  "message": "success", // æˆåŠŸæˆ–é”™è¯¯ä¿¡æ¯
  "data": {} | null     // è¿”å›æ•°æ®
}
```

### **é”™è¯¯ç è§„èŒƒ**

| code | å«ä¹‰                |
|------| ----------------- |
| 200  | æˆåŠŸ                |
| 400  | å‚æ•°é”™è¯¯ / ä¸šåŠ¡å¼‚å¸¸       |
| 401  | æœªç™»å½• / token æ— æ•ˆæˆ–è¿‡æœŸ |
| 403  | æ— æƒé™               |
| 500  | æœåŠ¡å™¨é”™è¯¯             |

---

# 1. **å­¦ç”Ÿæ³¨å†Œæ¥å£**

## **POST /api/auth/register**

### æè¿°

* å­¦ç”Ÿè‡ªè¡Œæ³¨å†Œè´¦å·
* æ³¨å†ŒæˆåŠŸåéœ€è¦æ‰‹åŠ¨ç™»å½•
* role å›ºå®šä¸º `"student"`

---

### è¯·æ±‚å‚æ•°ï¼ˆJSONï¼‰

```json
{
  "username": "20240123",
  "password": "123456"
}
```

å­—æ®µè¯´æ˜ï¼š

| å­—æ®µ       | å¿…å¡« | è¯´æ˜              |
| -------- | -- | --------------- |
| username | æ˜¯  | ç”¨æˆ·åï¼ˆé€šå¸¸ä¸ºå­¦å·ï¼‰ï¼Œéœ€è¦å”¯ä¸€ |
| password | æ˜¯  | ç™»å½•å¯†ç             |

---

### å“åº”ï¼ˆæˆåŠŸï¼‰

```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•",
  "data": null
}
```

---

### å“åº”ï¼ˆå¤±è´¥ç¤ºä¾‹ï¼‰

ç”¨æˆ·åå·²å­˜åœ¨ï¼š

```json
{
  "code": 400,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null
}
```

å¯†ç ä¸ºç©ºï¼š

```json
{
  "code": 400,
  "message": "å¯†ç ä¸èƒ½ä¸ºç©º",
  "data": null
}
```

---

# 2. **ç™»å½•æ¥å£**

## **POST /api/auth/login**

### æè¿°

* ç”¨æˆ·ç™»å½•ï¼ˆå­¦ç”Ÿ/è€å¸ˆ/ç®¡ç†å‘˜ï¼‰
* è¿”å› JWT Token
* Token é€šè¿‡å‰ç«¯ä¿å­˜ï¼ˆpiniaï¼‰

---

### è¯·æ±‚å‚æ•°ï¼ˆJSONï¼‰

```json
{
  "username": "20240123",
  "password": "123456"
}
```

---

### å“åº”ï¼ˆæˆåŠŸï¼‰

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "20240123",
      "role": "student"
    }
  }
}
```

---

### å“åº”ï¼ˆå¤±è´¥ç¤ºä¾‹ï¼‰

ç”¨æˆ·åä¸å­˜åœ¨ï¼š

```json
{
  "code": 400,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "data": null
}
```

å¯†ç é”™è¯¯ï¼š

```json
{
  "code": 400,
  "message": "å¯†ç é”™è¯¯",
  "data": null
}
```

---

# 3. **é€€å‡ºæ¥å£ï¼ˆä½¿ç”¨é»‘åå•æœºåˆ¶ï¼‰**

## **POST /api/auth/logout**

### æè¿°

* å‰ç«¯è¯·æ±‚é€€å‡ºç™»å½•
* åç«¯å°†å½“å‰ token åŠ å…¥é»‘åå•
* å‰ç«¯è‡ªè¡Œæ¸…é™¤ token

---

### è¯·æ±‚å¤´

```
Authorization: Bearer <token>
```

---

### å“åº”ï¼ˆæˆåŠŸï¼‰

```json
{
  "code": 200,
  "message": "é€€å‡ºæˆåŠŸ",
  "data": null
}
```

---

# 4. **è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯**

## **GET /api/auth/me**

### æè¿°

* è·å–ç™»å½•ç”¨æˆ·è‡ªå·±çš„ä¿¡æ¯
* å¿…é¡»æºå¸¦ token

---

### è¯·æ±‚å¤´

```
Authorization: Bearer <token>
```

---

### å“åº”ï¼ˆæˆåŠŸï¼‰

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "20240123",
    "role": "student"
  }
}
```

---

### å“åº”ï¼ˆæœªç™»å½• / token æ— æ•ˆï¼‰

```json
{
  "code": 401,
  "message": "tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "data": null
}
```

---

# 6. **JWT ä¸æƒé™è¯´æ˜ï¼ˆé™„å½•ï¼‰**

### Token æºå¸¦æ–¹å¼

```
Authorization: Bearer <token>
```

### Token å†…å®¹ï¼ˆpayload ç¤ºä¾‹ï¼‰

```json
{
  "userId": 1,
  "role": "student",
  "exp": 1712345678
}
```

---

### Auth æ¨¡å—ä½¿ç”¨çš„å®‰å…¨æœºåˆ¶ï¼š

| åŠŸèƒ½              | æ˜¯å¦åŒ…å« | å®ç°æ–¹å¼                |
| --------------- | ---- | ------------------- |
| JWT ç™»å½•è®¤è¯        | âœ”    | jjwt / auth0 jwt    |
| Token è¿‡æœŸ        | âœ”    | exp å±æ€§              |
| Token é»‘åå•       | âœ”    | ConcurrentHashMap   |
| é€€å‡ºæœºåˆ¶            | âœ”    | é»‘åå• +æ¸…ç† token       |
| æƒé™æ³¨è§£            | âœ”    | @RequiresRole + AOP |
| Spring Security | âœ–    | ä¸ä½¿ç”¨                 |
| å…¨å±€å¼‚å¸¸å¤„ç†          | âœ”    | @ControllerAdvice   |

---